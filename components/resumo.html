<!-- components/resumo.html (v1.2)
     Modal de Resumo unificado: comanda (multi‑pet), dados principais, delivery, LGPD, upsell e ações.
-->

<div id="resumo-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="resumo-title" hidden>
  <div class="modal__overlay" data-action="close" tabindex="-1"></div>
  <div class="modal__dialog" role="document">
    <header class="modal__header">
      <h3 id="resumo-title" class="h4">Resumo do pedido</h3>
      <button class="btn btn--icon" type="button" aria-label="Fechar" data-action="close">
        <svg class="icon" aria-hidden="true"><use href="#i-close"/></svg>
      </button>
    </header>

    <div class="modal__content gap">
      <p class="muted" data-sentinel="start">Confira os dados, faça ajustes e envie pelo WhatsApp.</p>

      <!-- ————————————————————————— Comanda (multi‑pet) ————————————————————————— -->
      <section class="card card--flat" data-if="comanda.length">
        <header class="row row--between row--center">
          <h4 class="h5">Itens da comanda</h4>
          <span class="badge">Total: <span data-bind="comanda.length">0</span></span>
        </header>
        <ul class="list" id="comanda-modal-list"></ul>
        <p id="comanda-modal-empty" class="muted" hidden>Nenhum item na comanda.</p>
        <div class="row gap" style="margin-top:8px">
          <button class="btn" type="button" data-action="add-more-comanda">Adicionar mais à comanda</button>
        </div>
      </section>

      <!-- Template de linha da comanda (preenchido pelo JS) -->
      <template id="tpl-comanda-row">
        <li class="row row--between row--center">
          <span class="comanda__desc">Pet (Porte) — Serviços: …</span>
          <span class="row">
            <button class="btn btn--link" type="button" data-action="edit-comanda" data-idx="">Editar</button>
            <button class="btn btn--link" type="button" data-action="remove-comanda" data-idx="">Remover</button>
          </span>
        </li>
      </template>

      <!-- ———————————————————————— Fallback rascunho (quando comanda vazia) ———————————————————————— -->
      <section class="card card--flat">
        <h4 class="h5">Rascunho atual</h4>
        <ul class="list">
          <li><strong>Pet:</strong> <span data-bind="pet.nome">—</span> (<span data-bind="pet.porte">—</span>)</li>
          <li><strong>Serviços:</strong> <span data-bind="servicos._resumo">—</span></li>
        </ul>
        <p class="muted">Dica: para vários pets, use “Adicionar à comanda” no Wizard.</p>
      </section>

      <!-- ————————————————————————— Dados principais ————————————————————————— -->
      <section class="card card--flat">
        <h4 class="h5">Dados principais</h4>
        <ul class="list">
          <li><strong>Cliente:</strong> <span data-bind="cliente.nome">—</span> · <span data-bind="cliente.telefone">—</span> <button class="btn btn--link" data-edit="cliente">Editar</button></li>
          <li><strong>Quando:</strong> <span data-bind="agenda.data">—</span> · <span data-bind="agenda.janela">—</span> <button class="btn btn--link" data-edit="agenda">Editar</button></li>
          <li><strong>Onde:</strong> <span data-bind="logistica._resumo">—</span> <button class="btn btn--link" data-edit="logistica">Editar</button></li>
        </ul>
      </section>

      <!-- ————————————————————————— Itens de Delivery ————————————————————————— -->
      <section class="card card--flat">
        <h4 class="h5">Delivery (itens)</h4>
        <ul class="list" id="resumo-delivery-list"></ul>
        <div class="row gap">
          <button class="btn btn--link" type="button" data-edit="delivery">Adicionar/editar itens</button>
        </div>
      </section>

      <!-- ————————————————————————— Upsell ————————————————————————— -->
      <section class="card card--flat">
        <h4 class="h5">Talvez te interesse</h4>
        <div id="upsell-list" class="chip-list" role="listbox" aria-label="Sugestões"></div>
        <p id="upsell-empty" class="muted">Sem sugestões no momento.</p>
        <div class="row"><button class="btn btn--link" type="button" data-action="dismiss-upsell">Não mostrar por 30 dias</button></div>
      </section>

      <!-- ————————————————————————— LGPD ————————————————————————— -->
      <section id="lgpd-section" class="card card--flat">
        <label class="check">
          <input id="lgpd-consent-resumo" type="checkbox"> <span>Aceito ser atendido pelo WhatsApp. <span class="muted">Usamos seus dados apenas para atendimento.</span></span>
        </label>
      </section>

      <!-- ————————————————————————— Mensagem (texto bruto) ————————————————————————— -->
      <details class="card card--flat">
        <summary>Ver mensagem de WhatsApp (texto)</summary>
        <textarea id="resumo-text-raw" rows="6" readonly></textarea>
        <div class="row gap" style="margin-top:8px">
          <button class="btn" type="button" id="btn-copy-resumo">
            <svg class="icon" aria-hidden="true"><use href="#i-copy"/></svg>
            <span>Copiar</span>
          </button>
          <button class="btn btn--ghost" type="button" id="btn-clear-resumo">
            <svg class="icon" aria-hidden="true"><use href="#i-trash"/></svg>
            <span>Limpar rascunho</span>
          </button>
        </div>
      </details>
    </div>

    <footer class="modal__footer row row--between row--center">
      <div class="row gap">
        <button class="btn" type="button" data-action="close">Fechar</button>
        <button class="btn" type="button" data-edit="servicos">Editar serviços</button>
      </div>
      <div class="row gap">
        <button class="btn" type="button" data-action="open-resumo" hidden>Ver Resumo</button>
        <button class="btn" type="button" id="btn-copy-resumo">
          <svg class="icon" aria-hidden="true"><use href="#i-copy"/></svg>
          <span>Copiar</span>
        </button>
        <button class="btn btn--primary" type="button" id="btn-wa-resumo" disabled>
          <svg class="icon" aria-hidden="true"><use href="#i-whatsapp"/></svg>
          <span>Enviar pelo WhatsApp</span>
        </button>
      </div>
    </footer>
  </div>
</div>

<!-- Template de chip de upsell (reutilizado) -->
<template id="tpl-upsell-chip">
  <button class="chip" type="button" role="option" aria-checked="false" data-suggest-id="">
    <span class="chip__title">Sugestão</span>
    <span class="chip__sub muted"></span>
  </button>
</template>
